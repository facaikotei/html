<!doctype html>
<html>
    <head>
        <title>報修表單QRcode產生器</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/json5/2.2.3/index.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.4.4/qrcode.min.js"></script>
        <style></style>
    </head>
    <body>
        <form>
            <textarea id="input" placeholder="輸入資料..." rows="10" wrap="off" style="width: -webkit-fill-available;"></textarea>
            <hr/>
        </form>
        <div id="show"></div>
        <script>
            const input = document.querySelector('#input');
            const show = document.querySelector('#show');
            const defaultMessage = '<pre>//正確的資料應以如下格式表示：\n[\n//[教室名稱,直排,橫排],\n["資501A",6,11],\n["資405",4,8],\n//...\n["資001",6,12]\n]</pre>';
            show.innerHTML = defaultMessage;
            input.addEventListener('input',async () => {
                show.innerHTML = '';
                try {
                    const data = JSON5.parse(input.value);
                    for(const i of data)for(const j =1;j<=i[2];j++)for(const k =1;k<=i[1];k++){
                        const url = `https://translate.google.com/?text=${i[0]}+${j}-${k}`;
                        show.insertAdjacentHTML('beforeend', `<a href="${url}"><img src="${await QRCode.toDataURL(url)}" />${i[0]} ${j}-${k}</a>`);
                    }
                }
                catch(e){
                    show.innerHTML = defaultMessage;
                }
            }
            );
            function isValidData(dataString) {
                try {
                    if (JSON5.parse(dataString).every(i => Number.isInteger(i[1]) && i[1] > 0 && Number.isInteger(i[2]) && i[2] > 0)) {
                        return true;
                    } else {
                        return false;
                    }
                } catch (e) {
                    return false;
                }
            }
        </script>
    </body>
</html>


