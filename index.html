<!doctype html>
<html>
    <head>
        <title>報修表單QRcode產生器</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/json5/2.2.3/index.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.4.4/qrcode.min.js"></script>
        <style></style>
    </head>
    <body>
        <form>
            <textarea id="input" placeholder="輸入資料..." rows="10" wrap="off" style="width: -webkit-fill-available;"></textarea>
            <hr/>
        </form>
        <div id="show"></div>
        <script>
            let input = document.querySelector('#input');
            let show = document.querySelector('#show');
            let defaultMessage = '<pre>//正確的資料應以如下格式表示：\n[\n//[教室名稱,直排,橫排],\n["資501A",6,11],\n["資405",4,8],\n//...\n["資001",6,12]\n]</pre>';
            show.innerHTML = defaultMessage;
            input.addEventListener('input', async()=>{
                show.innerHTML = '';
                try {
                    let data = JSON5.parse(input.value);
                    let finalString = '';
                    for (let i of data) {
                        finalString += '<table>';
                        for (let j = 1; j <= i[2]; j++) {
                            finalString += '<tr>';
                            for (let k = 1; k <= i[1]; k++) {
                                finalString += '<td>';
                                let url = `https://docs.google.com/forms/d/e/1FAIpQLSchSA12i0tov9J9oD7pO6DHt-pujlsTPGQGWwZNXzwAVS2Vbw/viewform?usp=pp_url&entry.1259309815=${i[0]}+${k}-${j}`;
                                finalString += `<a href="${url}"><img src="${await QRCode.toDataURL(url)}" />${i[0]} ${k}-${j}</a>`;
                                finalString += '</td>';
                            }
                            finalString += '</tr>';
                        }
                        finalString += '</table>';
                    }
                    show.innerHTML = finalString;
                } catch (e) {
                    show.innerHTML = e + defaultMessage;
                }
            }
            );
        </script>
    </body>
</html>
